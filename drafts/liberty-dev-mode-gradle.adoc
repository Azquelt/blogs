---
layout: post
title: "Rapid application development with Gradle and Open Liberty's dev mode"
categories: blog
author_picture: https://avatars3.githubusercontent.com/u/28316667
author_github: https://github.com/rzgry
seo-title: Rapid application development with Gradle and Open Liberty's dev mode - OpenLiberty.io
seo-description: Develop Java applications quicker using Open Liberty development mode with Gradle.
blog_description: "Develop Java applications quicker using Open Liberty development mode with Gradle."
---
= Open Liberty development mode for Gradle
Ryan Zegray <https://github.com/rzgry>

Open Liberty development mode, or dev mode, now works with Gradle projects. Open Liberty dev mode allows you to develop applications with any text editor or IDE by providing hot reload and deployment, on demand testing, and debugger support. Your code is automatically compiled and deployed to your running server, making it easy to iterate on your changes. You can run tests on demand or even automatically so that you can get immediate feedback on your changes. You can also attach a debugger at any time to debug your running application.

We will be enabling a MicroProfile health check endpoint in a sample REST microservice using Open Liberty dev mode and Gradle.

You can follow along by cloning the https://github.com/OpenLiberty/demo-devmode[demo-devmode] sample project.

----
git clone https://github.com/OpenLiberty/demo-devmode.git
----

== Including the liberty gradle plugin

For Gradle projects, dev mode is run through the Liberty Gradle Plugin version `3.0` or above. You will notice the sample project defines the plugin in the projects `build.gradle` file.

[source,groovy]
----
buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'io.openliberty.tools:liberty-gradle-plugin:3.0'
    }
}
----

== Starting the application using dev mode

Start dev mode by running the following command in your project: `gradle libertyDev`. This will start the server in dev mode along with installing features and deploying your application.

== Automatically recompiling and deploying to the running server

Once dev mode is started, source code changes are automatically compiled and deployed to the running server. If any features are added to the `server.xml` file, they are installed automatically.

Add the `mpHealth-2.1` feature to `src/main/liberty/config/server.xml`. You can now access the http://localhost:9080/health endpoint (though it's just an empty array).

Create the `src/main/java/io/openliberty/sample/system/SystemLivenessCheck.java` class. Changes are reflected in the http://localhost:9080/health endpoint

[source,java]
----
package io.openliberty.sample.system;

import javax.enterprise.context.ApplicationScoped;

import java.lang.management.MemoryMXBean;
import java.lang.management.ManagementFactory;

import org.eclipse.microprofile.health.Liveness;
import org.eclipse.microprofile.health.HealthCheck;
import org.eclipse.microprofile.health.HealthCheckResponse;

@Liveness
@ApplicationScoped
public class SystemLivenessCheck implements HealthCheck {

    @Override
    public HealthCheckResponse call() {
        MemoryMXBean memBean = ManagementFactory.getMemoryMXBean();
        long memUsed = memBean.getHeapMemoryUsage().getUsed();
        long memMax = memBean.getHeapMemoryUsage().getMax();
  
        return HealthCheckResponse.named(
            SystemResource.class.getSimpleName() + " liveness check")
                                  .withData("memory used", memUsed)
                                  .withData("memory max", memMax)
                                  .state(memUsed < memMax * 0.9).build();
    }
    
}
----

== Running tests automatically and on demand

Go to the console where you started dev mode, and press Enter. This will run the tests on a separate thread while dev mode is still active.

To run tests automatically after every change, include the `--hotTests` parameter when starting dev mode.  For example: `gradle libertyDev --hotTests`

== Attaching a debugger

At any point during dev mode, you can attach a Java debugger to debug your application.  By default, the debug port is `7777`, but another port can be used and shown in the console output if the default port is not available.

In `src/main/java/io/openliberty/sample/system/SystemLivenessCheck.java`, set a breakpoint inside the call() method.

Attach your IDE's debugger to port 7777.
For example, in VS Code, click Debug > Add Configuration... > Java: Attach > set "port": "7777". Then View > Debug > select Debug (Attach), then press the arrow icon to start debugging.

In your browser, go to http://localhost:9080/health.

Notice your IDE pauses at the breakpoint that you set, allowing you to debug.

Disconnect the debugger.

When you are done, press Ctrl-C in the console to terminate dev mode and stop your server.

== Stopping dev mode

You can quit dev mode at any time by pressing CTRL+C in the terminal, or type `q` and press Enter.

== VS Code extension

The https://marketplace.visualstudio.com/items?itemName=Open-Liberty.liberty-dev-vscode-ext[Open Liberty Tools VS Code extension] has also been updated to support Gradle projects. This optional extension lets you interact with dev mode entirely within VS Code. You can start Open Liberty in development mode, make changes to your application while the server is up, run tests and view results, and even debug the application without leaving the editor.

image::/img/blog/liberty-dev-vscode-gradle.png[Liberty Dev Dashboard, align="left", width=400]

For more information on the Open Liberty Tools VS Code extension, you can read about it in the link:/blog/2019/11/13/liberty-dev-mode-vscode.html[Open Liberty dev mode with VS Code blog post].

== Further reading

For more details on dev mode, see the documentation for the https://github.com/OpenLiberty/ci.gradle/blob/master/docs/libertyDev.md#libertydev-task[libertyDev task].
